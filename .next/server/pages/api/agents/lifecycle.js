"use strict";(()=>{var e={};e.id=169,e.ids=[169],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},1820:(e,t,s)=>{s.r(t),s.d(t,{config:()=>y,default:()=>h,routeModule:()=>p});var r={};s.r(r),s.d(r,{default:()=>u});var a=s(1802),n=s(7153),o=s(6249);let i=new Map;async function u(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{action:s,agentId:r,data:a}=e.body;switch(s){case"register":return await l(e,t,a);case"assign":return await c(e,t,r,a);case"health":return await f(e,t,r);case"log":return await g(e,t,r,a);default:return t.status(400).json({error:"Invalid action"})}}catch(e){return console.error("Agent lifecycle error:",e),t.status(500).json({error:"Internal server error"})}}async function l(e,t,s){let{name:r,config:a}=s;if(!r)return t.status(400).json({error:"Agent name is required"});let n=`agent_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:n,name:r,status:"idle",health:{lastCheck:new Date,isAlive:!0,errorCount:0},logs:[{timestamp:new Date,action:"register",message:"Agent registered successfully",level:"info"}],retryConfig:{maxRetries:a?.maxRetries||3,backoffMs:a?.backoffMs||1e3,currentRetries:0}};return i.set(n,o),t.status(201).json({success:!0,agentId:n,message:"Agent registered successfully"})}async function c(e,t,s,r){let a=i.get(s);if(!a)return t.status(404).json({error:"Agent not found"});if("busy"===a.status)return t.status(409).json({error:"Agent is busy"});let{taskId:n,taskType:o,payload:u}=r;if(!n||!o)return t.status(400).json({error:"Task ID and type are required"});a.status="busy",a.logs.push({timestamp:new Date,action:"assign",message:`Assigned task ${n} of type ${o}`,level:"info"});try{await d(a,n,o,u),a.status="idle"}catch(e){a.status="error",a.health.errorCount++,a.logs.push({timestamp:new Date,action:"error",message:`Task ${n} failed: ${e.message}`,level:"error"})}return t.status(200).json({success:!0,message:"Task assigned successfully",agentStatus:a.status})}async function f(e,t,s){let r=i.get(s);if(!r)return t.status(404).json({error:"Agent not found"});r.health.lastCheck=new Date;let a=Date.now()-r.health.lastCheck.getTime();return r.health.isAlive=a<3e5,t.status(200).json({success:!0,health:r.health,status:r.status,lastActivity:r.health.lastCheck})}async function g(e,t,s,r){let a=i.get(s);if(!a)return t.status(404).json({error:"Agent not found"});let{action:n,message:o,level:u="info"}=r;return n&&o?(a.logs.push({timestamp:new Date,action:n,message:o,level:u}),a.logs.length>100&&(a.logs=a.logs.slice(-100)),t.status(200).json({success:!0,message:"Log entry added successfully"})):t.status(400).json({error:"Action and message are required"})}async function d(e,t,s,r){let a;for(let n=1;n<=e.retryConfig.maxRetries;n++)try{await m(t,s,r),e.retryConfig.currentRetries=0;return}catch(s){if(a=s,e.retryConfig.currentRetries=n,e.logs.push({timestamp:new Date,action:"retry",message:`Task ${t} failed, attempt ${n}/${e.retryConfig.maxRetries}`,level:"warn"}),n<e.retryConfig.maxRetries){let t=e.retryConfig.backoffMs*Math.pow(2,n-1);await new Promise(e=>setTimeout(e,t))}}throw a}async function m(e,t,s){if(await new Promise(e=>setTimeout(e,100)),.3>Math.random())throw Error(`Simulated failure for task ${e}`);return{success:!0,taskId:e,result:"Task completed successfully"}}let h=(0,o.l)(r,"default"),y=(0,o.l)(r,"config"),p=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/agents/lifecycle",pathname:"/api/agents/lifecycle",bundlePath:"",filename:""},userland:r})},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var s=t(t.s=1820);module.exports=s})();