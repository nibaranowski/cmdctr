(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{8146:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/metabox",function(){return s(6753)}])},6753:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var a=s(5893),r=s(7294),n=s(1163),i=s(3472);let l=i.z.object({id:i.z.string().min(1),name:i.z.string().min(1),order:i.z.number().int().nonnegative(),description:i.z.string().optional(),agent_id:i.z.string().optional(),metabox_id:i.z.string().min(1),created_at:i.z.string().datetime(),updated_at:i.z.string().datetime()}),o=i.z.object({id:i.z.string().min(1),name:i.z.string().min(1),description:i.z.string(),phases:i.z.array(l),created_at:i.z.string().datetime(),updated_at:i.z.string().datetime(),version:i.z.number().int().positive()});i.z.object({id:i.z.string().min(1),name:i.z.string().min(1),description:i.z.string().optional(),company_id:i.z.string().min(1),owner_id:i.z.string().optional(),shared_with:i.z.array(i.z.string()),phases:i.z.array(l),templates:i.z.array(o),version:i.z.number().int().positive(),created_at:i.z.string().datetime(),updated_at:i.z.string().datetime(),metadata:i.z.record(i.z.unknown()).optional()});class d{update(e){void 0!==e.name&&(this.name=e.name),void 0!==e.description&&(this.description=e.description),void 0!==e.shared_with&&(this.shared_with=e.shared_with),void 0!==e.metadata&&(this.metadata=e.metadata),this.version++,this.updated_at=new Date().toISOString()}addPhase(e){let t=new m({...e,metabox_id:this.id});this.phases.push(t),this.phases.sort((e,t)=>e.order-t.order),this.version++,this.updated_at=new Date().toISOString()}removePhase(e){let t=this.phases.length;return this.phases=this.phases.filter(t=>t.id!==e),this.phases.length!==t&&(this.version++,this.updated_at=new Date().toISOString(),!0)}createTemplate(e,t){let s=new c({name:e,description:t,phases:this.phases.map(e=>({id:e.id,name:e.name,order:e.order,description:e.description,agent_id:e.agent_id,metabox_id:e.metabox_id,created_at:e.created_at,updated_at:e.updated_at}))});return this.templates.push(s),this.version++,this.updated_at=new Date().toISOString(),s}applyTemplate(e){this.phases=e.phases.map(e=>new m({...e,id:"phase_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),metabox_id:this.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),this.version++,this.updated_at=new Date().toISOString()}canAccess(e){return this.owner_id===e||this.shared_with.includes(e)}canEdit(e){return this.owner_id===e}detectConflict(e){return e.version<this.version?{hasConflict:!0,message:"Version conflict: local version ".concat(this.version,", incoming version ").concat(e.version)}:{hasConflict:!1}}constructor(e){this.id=e.id||"metabox_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),this.name=e.name,this.description=e.description,this.company_id=e.company_id,this.owner_id=e.owner_id,this.shared_with=e.shared_with||[],this.phases=(e.phases||[]).map(e=>new m(e)),this.templates=(e.templates||[]).map(e=>new c(e)),this.version=e.version||1,this.created_at=e.created_at||new Date().toISOString(),this.updated_at=e.updated_at||new Date().toISOString(),this.metadata=e.metadata}}class c{update(e){void 0!==e.name&&(this.name=e.name),void 0!==e.description&&(this.description=e.description),void 0!==e.phases&&(this.phases=e.phases.map(e=>new m(e))),this.version++,this.updated_at=new Date().toISOString()}constructor(e){this.id=e.id||"template_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),this.name=e.name,this.description=e.description,this.phases=(e.phases||[]).map(e=>new m(e)),this.created_at=e.created_at||new Date().toISOString(),this.updated_at=e.updated_at||new Date().toISOString(),this.version=e.version||1}}class m{update(e){void 0!==e.name&&(this.name=e.name),void 0!==e.order&&(this.order=e.order),void 0!==e.description&&(this.description=e.description),void 0!==e.agent_id&&(this.agent_id=e.agent_id),this.updated_at=new Date().toISOString()}constructor(e){this.id=e.id||"phase_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),this.name=e.name,this.order=e.order,this.description=e.description,this.agent_id=e.agent_id,this.metabox_id=e.metabox_id,this.created_at=e.created_at||new Date().toISOString(),this.updated_at=e.updated_at||new Date().toISOString()}}let x={fundraising:{name:"Fundraising",description:"Complete fundraising pipeline with investor research and outreach",default_phases:["Target List","Outreach","Scheduling","Negotiation","Closing"],default_agents:{"Target List":["InvestorResearchAgent"],Outreach:["AIOutreachAgent"],Scheduling:["MeetingSchedulerAgent"],Negotiation:["DealNegotiatorAgent"],Closing:["LegalReviewAgent"]}},hiring:{name:"Hiring",description:"End-to-end hiring process from sourcing to onboarding",default_phases:["Sourcing","Screening","Interviews","Offer","Onboarding"],default_agents:{Sourcing:["AIRecruiterAgent"],Screening:["ResumeScreenerAgent"],Interviews:["InterviewInsightsAgent"],Offer:["OfferNegotiatorAgent"],Onboarding:["OnboardingCoordinatorAgent"]}},selling:{name:"Sales",description:"Sales pipeline with lead qualification and deal management",default_phases:["Lead Generation","Qualification","Proposal","Negotiation","Closing"],default_agents:{"Lead Generation":["LeadGeneratorAgent"],Qualification:["LeadQualifierAgent"],Proposal:["ProposalWriterAgent"],Negotiation:["SalesNegotiatorAgent"],Closing:["DealCloserAgent"]}}},h=e=>{let{phase:t,isSelected:s,canEdit:n,onUpdate:i,onDelete:l,onSelect:o}=e,[d,c]=(0,r.useState)(!1),[m,x]=(0,r.useState)(t.name),[h,u]=(0,r.useState)(t.description||""),p=()=>{window.confirm("Are you sure you want to delete this phase?")&&l()};return(0,a.jsx)("div",{className:"bg-white border rounded-lg shadow-sm transition-all duration-200 cursor-pointer ".concat(s?"ring-2 ring-blue-500 border-blue-300":"border-gray-200 hover:border-gray-300"),onClick:o,children:(0,a.jsx)("div",{className:"p-4",children:d?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"phase-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phase Name"}),(0,a.jsx)("input",{id:"phase-name",type:"text",value:m,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter phase name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"phase-description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,a.jsx)("textarea",{id:"phase-description",value:h,onChange:e=>u(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter phase description"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{x(t.name),u(t.description||""),c(!1)},className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{i({name:m,description:h||void 0}),c(!1)},disabled:!m.trim(),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save"})]})]}):(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:t.order}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:t.name})]}),t.description&&(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:t.description})]}),n&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c(!0)},className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Edit phase",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),p()},className:"p-1 text-gray-400 hover:text-red-600 rounded",title:"Delete phase",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[t.agent_id&&(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Agent assigned"]}),(0,a.jsxs)("span",{children:["Created ",new Date(t.created_at).toLocaleDateString()]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsxs)("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:["ID: ",t.id.slice(-8)]})})]})]})})})},u=e=>{let{onSelect:t,onCancel:s,currentPhases:n}=e,[i,l]=(0,r.useState)(null),o=e=>{let s=x[e];if(!s)return;let a=s.default_phases.map((e,t)=>({id:"phase_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),name:e,order:t+1,description:"Default ".concat(e.toLowerCase()," phase"),metabox_id:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}));t(new c({name:s.name,description:s.description,phases:a}))};return(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Select Template"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),n.length>0&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Warning"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,a.jsx)("p",{children:"Applying a template will replace all current phases. This action cannot be undone."})})]})]})}),(0,a.jsx)("div",{className:"space-y-3",children:Object.entries(x).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"border rounded-lg p-4 cursor-pointer transition-colors ".concat(i===t?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>l(t),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:s.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[s.default_phases.length," phases"]})})]}),i===t&&(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]}),i===t&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[(0,a.jsx)("h5",{className:"text-xs font-medium text-gray-700 mb-2",children:"Phases:"}),(0,a.jsx)("div",{className:"space-y-1",children:s.default_phases.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,a.jsx)("span",{className:"w-6 h-6 flex items-center justify-center bg-gray-100 rounded-full mr-2",children:t+1}),e]},t))})]})]},t)})}),(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-3 mt-6",children:[(0,a.jsx)("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{i&&o(i)},disabled:!i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Apply Template"})]})]})})})},p=e=>{let{canEdit:t,canUndo:s,canRedo:r,onUndo:n,onRedo:i,onTemplateSelect:l,onSave:o,onCancel:d,isSaving:c}=e;return(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("button",{onClick:n,disabled:!s||!t,className:"p-2 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed rounded",title:"Undo",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),(0,a.jsx)("button",{onClick:i,disabled:!r||!t,className:"p-2 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed rounded",title:"Redo",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})})})]}),(0,a.jsx)("div",{className:"w-px h-6 bg-gray-300"}),t&&(0,a.jsxs)("button",{onClick:l,className:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"})}),"Templates"]}),(0,a.jsx)("div",{className:"w-px h-6 bg-gray-300"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:d,className:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),t&&(0,a.jsx)("button",{onClick:o,disabled:c,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Save"]})})]})]})};class g{pushState(e){let t=this.deepClone(e);this.undoStack.push(t),this.redoStack=[],this.undoStack.length>this.maxStackSize&&this.undoStack.shift()}undo(){if(0===this.undoStack.length)return null;let e=this.undoStack.pop();this.redoStack.push(e);let t=this.undoStack[this.undoStack.length-1];return t?this.deepClone(t):null}redo(){if(0===this.redoStack.length)return null;let e=this.redoStack.pop();return this.undoStack.push(this.deepClone(e)),e}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[]}deepClone(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e))return e.map(e=>this.deepClone(e));if("object"==typeof e){let t={};for(let s in e)e.hasOwnProperty(s)&&(t[s]=this.deepClone(e[s]));return t}return e}constructor(e=50){this.undoStack=[],this.redoStack=[],this.maxStackSize=e}}let b=e=>{let{metaBox:t,onSave:s,onCancel:n,companyId:i,userId:l}=e,[o,c]=(0,r.useState)(t),[m,x]=(0,r.useState)(!1),[b,f]=(0,r.useState)(null),[j,y]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),w=(0,r.useRef)(new g),k=(0,r.useRef)(null),S=o.canEdit(l),C=o.canAccess(l),_=(0,r.useCallback)(e=>{if(!S)return;let t=new d({...o,phases:[...o.phases]});t.addPhase(e),w.current.pushState(o),c(t)},[o,S]),L=(0,r.useCallback)((e,t)=>{if(!S)return;let s=new d({...o,phases:o.phases.map(s=>s.id===e?{...s,...t}:s)});w.current.pushState(o),c(s)},[o,S]),D=(0,r.useCallback)(e=>{if(!S)return;let t=new d({...o,phases:[...o.phases]});t.removePhase(e),w.current.pushState(o),c(t)},[o,S]),A=(0,r.useCallback)((e,t)=>{if(!S)return;let s=[...o.phases],a=s.findIndex(t=>t.id===e),r=s.findIndex(e=>e.id===t);if(-1===a||-1===r)return;let[n]=s.splice(a,1);s.splice(r,0,n),s.forEach((e,t)=>{e.order=t+1});let i=new d({...o,phases:s});w.current.pushState(o),c(i)},[o,S]),M=(0,r.useCallback)(()=>{let e=w.current.undo();e&&c(e)},[]),z=(0,r.useCallback)(()=>{let e=w.current.redo();e&&c(e)},[]),O=(0,r.useCallback)(e=>{if(!S)return;let t=new d({...o,phases:[...o.phases]});t.applyTemplate(e),w.current.pushState(o),c(t),y(!1)},[o,S]),P=(0,r.useCallback)(async()=>{if(S){N(!0);try{await s(o)}catch(e){console.error("Failed to save meta box:",e)}finally{N(!1)}}},[o,s,S]),I=(0,r.useCallback)((e,t)=>{S&&(x(!0),f(t),e.dataTransfer.setData("text/plain",t))},[S]),E=(0,r.useCallback)(()=>{x(!1),f(null)},[]),B=(0,r.useCallback)((e,t)=>{if(!S)return;e.preventDefault();let s=e.dataTransfer.getData("text/plain");s&&s!==t&&A(s,t)},[S,A]),T=(0,r.useCallback)(e=>{e.preventDefault()},[]);return C?(0,a.jsxs)("div",{className:"flex flex-col h-full bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:o.name}),o.description&&(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:o.description})]}),(0,a.jsx)("div",{className:"flex items-center space-x-3",children:(0,a.jsx)(p,{canEdit:S,canUndo:w.current.canUndo(),canRedo:w.current.canRedo(),onUndo:M,onRedo:z,onTemplateSelect:()=>y(!0),onSave:P,onCancel:n,isSaving:v})})]})}),(0,a.jsx)("div",{className:"flex-1 flex overflow-hidden",children:(0,a.jsx)("div",{className:"flex-1 p-6 overflow-y-auto",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Phases"}),S&&(0,a.jsx)("button",{onClick:()=>_({name:"New Phase",order:o.phases.length+1,description:""}),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Add Phase"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[o.phases.map((e,t)=>(0,a.jsx)("div",{ref:k,draggable:S,onDragStart:t=>I(t,e.id),onDragEnd:E,onDrop:t=>B(t,e.id),onDragOver:T,className:"transition-all duration-200 ".concat(m&&b===e.id?"opacity-50":""),children:(0,a.jsx)(h,{phase:e,isSelected:b===e.id,canEdit:S,onUpdate:t=>L(e.id,t),onDelete:()=>D(e.id),onSelect:()=>f(e.id)})},e.id)),0===o.phases.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-4",children:(0,a.jsx)("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No phases yet"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Get started by adding your first phase or applying a template."}),S&&(0,a.jsxs)("div",{className:"space-x-3",children:[(0,a.jsx)("button",{onClick:()=>_({name:"First Phase",order:1,description:"Start here"}),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:"Add First Phase"}),(0,a.jsx)("button",{onClick:()=>y(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Apply Template"})]})]})]})]})})}),j&&(0,a.jsx)(u,{onSelect:O,onCancel:()=>y(!1),currentPhases:o.phases})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600",children:"You don't have permission to view this meta box."})]})})};var f=e=>{let{manifest:t,onPhaseAction:s,onAgentMessage:n}=e,[i,l]=(0,r.useState)(new Set),[o,d]=(0,r.useState)({}),c=e=>{let t=new Set(i);t.has(e)?t.delete(e):t.add(e),l(t)},m=e=>{let t=o[e];(null==t?void 0:t.trim())&&n&&(n(e,t.trim()),d(t=>({...t,[e]:""})))},x=e=>t.agents.find(t=>t.id===e),h=e=>{switch(e){case"active":return"bg-green-500";case"complete":return"bg-blue-500";default:return"bg-gray-400"}},u=e=>{switch(e){case"online":return"bg-green-500";case"busy":return"bg-yellow-500";default:return"bg-gray-400"}};return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:[t.name," Pipeline"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[t.phases.length," phases â€¢ ",t.agents.length," agents"]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"space-y-1 p-4",children:t.phases.map(e=>{let t=x(e.agentId),r=i.has(e.id);return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden","data-testid":"phase-".concat(e.id),children:[(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center space-x-3",children:(0,a.jsxs)("button",{onClick:()=>c(e.id),className:"flex items-center space-x-2 text-left hover:bg-gray-50 rounded px-2 py-1 transition-colors","aria-expanded":r,"aria-label":"".concat(r?"Collapse":"Expand"," ").concat(e.name," phase"),children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-500 transition-transform ".concat(r?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.name})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(h(e.status))}),t&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-xs font-medium text-gray-700",children:t.name.charAt(0)}),(0,a.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white ".concat(u(t.status))})]})]})]})}),r&&(0,a.jsxs)("div",{className:"border-t border-gray-100 bg-gray-50 p-4 space-y-4",children:[t&&(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-sm font-medium text-gray-700",children:t.name.charAt(0)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:t.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:t.status})]})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>null==s?void 0:s(e.id,"complete"),className:"px-3 py-1 text-xs font-medium bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors",disabled:"complete"===e.status,children:"Mark Complete"}),(0,a.jsx)("button",{onClick:()=>null==s?void 0:s(e.id,"revert"),className:"px-3 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",disabled:"pending"===e.status,children:"Revert"}),(0,a.jsx)("button",{onClick:()=>null==s?void 0:s(e.id,"trigger"),className:"px-3 py-1 text-xs font-medium bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors",children:"Trigger Agent"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700",children:"Message Agent"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",value:o[e.id]||"",onChange:t=>d(s=>({...s,[e.id]:t.target.value})),placeholder:"Ask agent for help...",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:t=>"Enter"===t.key&&m(e.id)}),(0,a.jsx)("button",{onClick:()=>m(e.id),className:"px-3 py-2 text-sm font-medium bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Send"})]})]})]})]},e.id)})})})]})},j=e=>{var t;let{coreObject:s,manifest:r,isSelected:n=!1,onClick:i,onDragStart:l}=e,o=s.assignedAgent?r.agents.find(e=>e.id===s.assignedAgent):null;return(0,a.jsxs)("div",{className:"bg-white border rounded-lg shadow-sm p-4 cursor-pointer transition-all duration-200 hover:shadow-md ".concat(n?"ring-2 ring-blue-500 border-blue-300":"border-gray-200 hover:border-gray-300"),onClick:i,draggable:!!l,onDragStart:l,"data-testid":"core-object-card-".concat(s.id),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["ID: ",s.id.slice(-8)]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end space-y-1 ml-2",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((e=>{switch(e.toLowerCase()){case"active":case"in progress":return"bg-green-100 text-green-800";case"complete":case"done":return"bg-blue-100 text-blue-800";case"pending":case"waiting":return"bg-yellow-100 text-yellow-800";case"blocked":case"stuck":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(s.status)),children:s.status}),s.priority&&(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((e=>{switch(null==e?void 0:e.toLowerCase()){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}})(s.priority)),children:s.priority})]})]}),o&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-medium text-blue-700",children:o.name.charAt(0).toUpperCase()})}),(0,a.jsx)("span",{className:"text-xs text-gray-600",children:o.name})]}),(0,a.jsx)("div",{className:"space-y-2",children:r.fields.slice(0,3).map(e=>{let t=s[e.key];return t?(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[e.label,":"]}),(0,a.jsx)("span",{className:"text-xs text-gray-900 font-medium truncate ml-2",children:"date"===e.type&&t?new Date(t).toLocaleDateString():"number"===e.type&&"number"==typeof t?t.toLocaleString():String(t)})]},e.key):null})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-100",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:s.updatedAt?"Updated ".concat(new Date(s.updatedAt).toLocaleDateString()):"Recently updated"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,a.jsx)("span",{className:"text-xs text-gray-600",children:(null===(t=r.phases.find(e=>e.id===s.currentPhase))||void 0===t?void 0:t.name)||s.currentPhase})]})]})]})},y=e=>{let{manifest:t,coreObjects:s,selectedObjectId:n,onObjectSelect:i,onObjectMove:l}=e,[o,d]=(0,r.useState)(null),[c,m]=(0,r.useState)(null),x=(0,r.useRef)(0),h=(e,t)=>{d(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t)},u=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",m(t)},p=e=>{e.preventDefault(),x.current++},g=e=>{e.preventDefault(),x.current--,0===x.current&&m(null)},b=(e,t)=>{if(e.preventDefault(),x.current=0,m(null),o&&l){let e=s.find(e=>e.id===o);e&&e.currentPhase!==t&&l(o,e.currentPhase,t)}d(null)},f=e=>s.filter(t=>t.currentPhase===e),y=e=>{switch(e){case"active":return"bg-green-500";case"complete":return"bg-blue-500";default:return"bg-gray-400"}};return(0,a.jsx)("div",{className:"flex space-x-6 h-full overflow-x-auto p-4",children:t.phases.map(e=>{let s=f(e.id),r=c===e.id;return(0,a.jsxs)("div",{className:"flex-shrink-0 w-80 bg-gray-50 rounded-lg border-2 border-dashed transition-colors ".concat(r?"border-blue-400 bg-blue-50":"border-gray-200"),onDragOver:t=>u(t,e.id),onDragEnter:p,onDragLeave:g,onDrop:t=>b(t,e.id),"data-testid":"kanban-phase-".concat(e.id),children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white rounded-t-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(y(e.status))}),(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:e.name})]}),(0,a.jsx)("span",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:s.length})]})}),(0,a.jsx)("div",{className:"p-4 space-y-3 min-h-[400px]",children:0===s.length?(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,a.jsx)("svg",{className:"mx-auto h-8 w-8 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("p",{className:"text-sm",children:"No items"})]}):s.map(e=>(0,a.jsx)("div",{className:"transition-transform duration-200 ".concat(o===e.id?"opacity-50 scale-95":""),children:(0,a.jsx)(j,{coreObject:e,manifest:t,isSelected:n===e.id,onClick:()=>null==i?void 0:i(e.id),onDragStart:t=>h(t,e.id)})},e.id))})]},e.id)})})},v=e=>{let{manifest:t,coreObjects:s,selectedObjectId:n,onObjectSelect:i}=e,[l,o]=(0,r.useState)("name"),[d,c]=(0,r.useState)("asc"),[m,x]=(0,r.useState)({}),h=e=>{l===e?c("asc"===d?"desc":"asc"):(o(e),c("asc"))},u=(e,t)=>{x(s=>({...s,[e]:t}))},p=(0,r.useMemo)(()=>{let e=s.filter(e=>Object.entries(m).every(t=>{let[s,a]=t;if(!a)return!0;let r=e[s];return null==r?void 0:r.toString().toLowerCase().includes(a.toLowerCase())}));return e.sort((e,t)=>{let s=e[l],a=t[l];if(s===a)return 0;if(null==s)return 1;if(null==a)return -1;let r=s<a?-1:1;return"asc"===d?r:-r}),e},[s,l,d,m]),g=(e,s)=>{switch(e.type){case"status":return(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("active"===s?"bg-green-100 text-green-800":"complete"===s?"bg-blue-100 text-blue-800":"pending"===s?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:s||"-"});case"agent":let r=t.agents.find(e=>e.id===s);return r?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-xs font-medium text-gray-700",children:r.name.charAt(0)}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:r.name})]}):(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Unassigned"});case"date":return(0,a.jsx)("span",{className:"text-sm text-gray-600",children:s?new Date(s).toLocaleDateString():"-"});case"number":return(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"number"==typeof s?s.toLocaleString():s||"-"});default:return(0,a.jsx)("span",{className:"text-sm text-gray-900 truncate",children:s||"-"})}},b=e=>{let{field:t}=e;return l!==t?(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):(0,a.jsx)("svg",{className:"w-4 h-4 ".concat("text-blue-600"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"asc"===d?"M5 15l7-7 7 7":"M19 9l-7 7-7-7"})})};return(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:(0,a.jsx)("div",{className:"grid grid-cols-4 gap-4",children:t.fields.slice(0,4).map(e=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Filter ",e.label]}),(0,a.jsx)("input",{type:"text",value:m[e.key]||"",onChange:t=>u(e.key,t.target.value),placeholder:"Filter ".concat(e.label,"..."),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]},e.key))})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item"}),t.fields.map(e=>(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider ".concat(e.sortable?"cursor-pointer hover:bg-gray-100":""),onClick:()=>e.sortable&&h(e.key),children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("span",{children:e.label}),e.sortable&&(0,a.jsx)(b,{field:e.key})]})},e.key)),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phase"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Updated"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===p.length?(0,a.jsx)("tr",{children:(0,a.jsxs)("td",{colSpan:t.fields.length+3,className:"px-6 py-12 text-center text-gray-500",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("p",{className:"text-sm",children:"No items found"})]})}):p.map(e=>(0,a.jsxs)("tr",{className:"cursor-pointer transition-colors ".concat(n===e.id?"bg-blue-50 border-l-4 border-l-blue-500":"hover:bg-gray-50"),onClick:()=>null==i?void 0:i(e.id),"data-testid":"list-item-".concat(e.id),children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-8 w-8",children:(0,a.jsx)("div",{className:"h-8 w-8 bg-gray-300 rounded-full flex items-center justify-center text-sm font-medium text-gray-700",children:(e.name||e.title||"#").charAt(0)})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name||e.title||"#".concat(e.id)}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.id})]})]})}),t.fields.map(t=>(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:g(t,e[t.key])},t.key)),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.currentPhase||"No phase"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.updatedAt?new Date(e.updatedAt).toLocaleDateString():"-"})]},e.id))})]})})]})};let N=e=>{let{manifest:t,onPhaseAction:s,onAgentMessage:n,onObjectSelect:i,onObjectMove:l}=e,[o,d]=(0,r.useState)("kanban"),[c,m]=(0,r.useState)(null),x=[{id:"1",name:"Sequoia Capital",currentPhase:"sourcing",status:"active",assignedAgent:"ai-research",priority:"high",updatedAt:"2024-01-15",investmentSize:"$10M",sector:"SaaS"},{id:"2",name:"Andreessen Horowitz",currentPhase:"outreach",status:"pending",assignedAgent:"ai-outreach",priority:"medium",updatedAt:"2024-01-14",investmentSize:"$5M",sector:"Fintech"},{id:"3",name:"Kleiner Perkins",currentPhase:"negotiation",status:"active",assignedAgent:"ai-negotiator",priority:"high",updatedAt:"2024-01-13",investmentSize:"$15M",sector:"AI/ML"},{id:"4",name:"Benchmark Capital",currentPhase:"closed",status:"complete",assignedAgent:"ai-admin",priority:"low",updatedAt:"2024-01-12",investmentSize:"$8M",sector:"E-commerce"}],h=e=>{m(e),null==i||i(e)};return(0,a.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col",children:(0,a.jsx)(f,{manifest:t,onPhaseAction:s,onAgentMessage:n})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h1",{className:"text-xl font-semibold text-gray-900",children:[t.name," Workspace"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 bg-gray-100 rounded-lg p-1",children:[(0,a.jsx)("button",{onClick:()=>d("kanban"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors ".concat("kanban"===o?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Kanban"}),(0,a.jsx)("button",{onClick:()=>d("list"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors ".concat("list"===o?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"List"})]})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:"kanban"===o?(0,a.jsx)(y,{manifest:t,coreObjects:x,selectedObjectId:c,onObjectSelect:h,onObjectMove:(e,t,s)=>{null==l||l(e,t,s),console.log("Moved object ".concat(e," from ").concat(t," to ").concat(s))}}):(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(v,{manifest:t,coreObjects:x,selectedObjectId:c,onObjectSelect:h})})})]}),(0,a.jsxs)("div",{className:"w-96 bg-white border-l border-gray-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Details & Activity"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Select an item to view details"})]}),(0,a.jsx)("div",{className:"flex-1 p-6",children:c?(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-4",children:"Item Details"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Detailed view for selected item coming soon..."})]}):(0,a.jsxs)("div",{className:"text-center text-gray-500 py-12",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("p",{className:"mt-2 text-sm",children:"No item selected"})]})})]})]})};var w=e=>{let{user:t}=e;(0,n.useRouter)();let[s,i]=(0,r.useState)([]),[l,o]=(0,r.useState)(null),[h,u]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!0),[f,j]=(0,r.useState)(null),[y,v]=(0,r.useState)("list");(0,r.useEffect)(()=>{w()},[]);let w=async()=>{try{g(!0);let e=await fetch("/api/metabox?company_id=".concat(t.company_id,"&user_id=").concat(t.id));if(!e.ok)throw Error("Failed to load meta boxes");let s=await e.json();i(s.data||[])}catch(e){j(e instanceof Error?e.message:"Failed to load meta boxes")}finally{g(!1)}},k=async e=>{try{let s=x[e],a=new d({name:"".concat(s.name," Pipeline"),description:s.description,company_id:t.company_id,owner_id:t.id}),r=new c({name:s.name,description:s.description,phases:s.default_phases.map((e,t)=>new m({id:"phase_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),name:e,order:t+1,description:"Default ".concat(e.toLowerCase()," phase"),metabox_id:a.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}))});a.applyTemplate(r);let n=await fetch("/api/metabox",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok)throw Error("Failed to create meta box");let l=await n.json();i(e=>[...e,l.data]),o(l.data),v("editor"),u(!1)}catch(e){j(e instanceof Error?e.message:"Failed to create meta box")}},S=async e=>{try{let s=await fetch("/api/metabox",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,user_id:t.id})});if(!s.ok)throw Error("Failed to save meta box");let a=await s.json();i(t=>t.map(t=>t.id===e.id?a.data:t)),o(a.data),v("workspace")}catch(e){j(e instanceof Error?e.message:"Failed to save meta box")}},C=async e=>{if(window.confirm("Are you sure you want to delete this meta box? This action cannot be undone."))try{if(!(await fetch("/api/metabox",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,user_id:t.id})})).ok)throw Error("Failed to delete meta box");i(t=>t.filter(t=>t.id!==e)),(null==l?void 0:l.id)===e&&(o(null),v("list"))}catch(e){j(e instanceof Error?e.message:"Failed to delete meta box")}};if(p)return(0,a.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})});if(f)return(0,a.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:f}),(0,a.jsx)("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"})]})});if("editor"===y&&l)return(0,a.jsxs)("div",{className:"h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>{v("list"),o(null)},className:"text-gray-600 hover:text-gray-900",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Edit Meta Box"})]})})}),(0,a.jsx)(b,{metaBox:l,onSave:S,onCancel:()=>{v("list"),o(null)},companyId:t.company_id,userId:t.id})]});if("workspace"===y&&l){let e={id:l.id,name:l.name,description:l.description||"",coreObjectType:"CoreObject",phases:l.phases.map(e=>({id:e.id,name:e.name,agentId:e.agent_id||"default-agent",status:"active"})),agents:[],fields:[{key:"name",label:"Name",type:"string",sortable:!0},{key:"status",label:"Status",type:"status",sortable:!0},{key:"priority",label:"Priority",type:"string",sortable:!0},{key:"assignedAgent",label:"Assigned Agent",type:"agent",sortable:!0}]};return(0,a.jsxs)("div",{className:"h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>{v("list"),o(null)},className:"text-gray-600 hover:text-gray-900",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:l.name})]}),(0,a.jsx)("button",{onClick:()=>v("editor"),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Edit"})]})}),(0,a.jsx)(N,{manifest:e,onPhaseAction:(e,t)=>{console.log("Phase action: ".concat(t," on phase ").concat(e))},onAgentMessage:(e,t)=>{console.log("Agent message for phase ".concat(e,": ").concat(t))},onObjectSelect:e=>{console.log("Selected object: ".concat(e))},onObjectMove:(e,t,s)=>{console.log("Moving object ".concat(e," from ").concat(t," to ").concat(s))}})]})}return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Meta Boxes"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Manage your workflow templates and processes"})]}),(0,a.jsxs)("button",{onClick:()=>u(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create Meta Box"]})]}),h&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Choose a Template"}),(0,a.jsx)("div",{className:"space-y-3",children:Object.entries(x).map(e=>{let[t,s]=e;return(0,a.jsxs)("button",{onClick:()=>k(t),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:s.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[s.default_phases.length," phases"]})})]},t)})}),(0,a.jsx)("div",{className:"mt-6 flex justify-end space-x-3",children:(0,a.jsx)("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded hover:bg-gray-200",children:"Cancel"})})]})})}),0===s.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No meta boxes"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating your first meta box."}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsxs)("button",{onClick:()=>u(!0),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create Meta Box"]})})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(e=>(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:e.name}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,a.jsxs)("span",{children:[e.phases.length," phases"]}),(0,a.jsxs)("span",{children:["Created ",new Date(e.created_at).toLocaleDateString()]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{o(e),v("workspace")},className:"p-2 text-gray-400 hover:text-blue-600 rounded",title:"Open workspace",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),(0,a.jsx)("button",{onClick:()=>{o(e),v("editor")},className:"p-2 text-gray-400 hover:text-gray-600 rounded",title:"Edit",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:()=>C(e.id),className:"p-2 text-gray-400 hover:text-red-600 rounded",title:"Delete",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})})},e.id))})]})})}}},function(e){e.O(0,[472,888,774,179],function(){return e(e.s=8146)}),_N_E=e.O()}]);