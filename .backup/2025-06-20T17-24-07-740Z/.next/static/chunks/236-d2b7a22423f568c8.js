"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[236],{2236:function(e,t,a){a.d(t,{m:function(){return o}});var r=a(5893),s=a(3114),l=a(9092),n=a(7294);let i=e=>{let{card:t,isSelected:a,isFocused:i,isDragging:c,onSelect:d,onDragStart:o,onDragEnd:u,onUpdate:m,onDelete:x,"data-testid":g}=e,[h,p]=(0,n.useState)(!1),[f,b]=(0,n.useState)(t.title),[y,v]=(0,n.useState)(!1),j=(0,n.useRef)(null),k=(0,n.useCallback)(()=>{d()},[d]),w=(0,n.useCallback)(e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id),o()},[t.id,o]),N=(0,n.useCallback)(()=>{u()},[u]),C=(0,n.useCallback)(()=>{p(!0),b(t.title)},[t.title]),D=(0,n.useCallback)(async()=>{if(!f.trim()||f===t.title){p(!1),b(t.title);return}if(m)try{await m(t.id,{title:f.trim()}),p(!1)}catch(e){console.error("Failed to update card title:",e),b(t.title)}},[f,t.title,t.id,m]),I=(0,n.useCallback)(()=>{p(!1),b(t.title)},[t.title]),E=(0,n.useCallback)(e=>{"Enter"===e.key?h?D():d():"Escape"===e.key?h&&I():"Delete"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),null==x||x(t.id))},[h,D,I,d,x,t.id]),L=(0,n.useCallback)(async()=>{if(x)try{await x(t.id)}catch(e){console.error("Failed to delete card:",e)}},[t.id,x]);return(0,r.jsxs)("div",{ref:j,className:"bg-white border rounded-lg shadow-sm p-4 cursor-pointer transition-all duration-200 ".concat(a?"ring-2 ring-blue-500 border-blue-300":"border-gray-200 hover:border-gray-300"," ").concat(c?"opacity-50 scale-105":""," ").concat(i?"ring-2 ring-blue-300":""),onClick:k,onDoubleClick:C,onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),draggable:!0,onDragStart:w,onDragEnd:N,onKeyDown:E,tabIndex:0,role:"button","aria-label":"".concat(t.title," card"),"data-testid":g,children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsx)("div",{className:"flex-1 min-w-0",children:h?(0,r.jsx)("textarea",{value:f,onChange:e=>b(e.target.value),onKeyDown:E,onBlur:D,className:"w-full text-sm font-medium text-gray-900 bg-transparent border-none resize-none focus:outline-none focus:ring-0",rows:2,autoFocus:!0}):(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:t.title})}),(0,r.jsx)("div",{className:"w-2 h-2 rounded-full ml-2 flex-shrink-0 ".concat((e=>{switch(e){case"urgent":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-300"}})(t.priority)),title:"Priority: ".concat(t.priority)})]}),t.description&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:t.description}),t.tags&&t.tags.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mb-3",children:[t.tags.slice(0,3).map((e,t)=>(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e},t)),t.tags.length>3&&(0,r.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:["+",t.tags.length-3]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[t.assignee&&(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("div",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-xs font-medium text-gray-700",children:t.assignee.charAt(0).toUpperCase()})})}),t.dueDate&&(0,r.jsx)("span",{className:"text-xs text-gray-500",children:new Date(t.dueDate).toLocaleDateString()})]}),(0,r.jsx)(s.M,{children:y&&(0,r.jsxs)(l.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center space-x-1",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),p(!0)},className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Edit",children:(0,r.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),x&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),L()},className:"p-1 text-gray-400 hover:text-red-600 rounded",title:"Delete",children:(0,r.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]}),i&&(0,r.jsx)("div",{className:"absolute inset-0 ring-2 ring-blue-500 ring-inset rounded-lg pointer-events-none"})]})},c=e=>{let{column:t,cards:a,isDragging:c,draggedCardId:d,focusedCardId:o,selectedCardId:u,onCardSelect:m,onCardMove:x,onCardCreate:g,onCardUpdate:h,onCardDelete:p,onDragStart:f,onDragEnd:b,onDrop:y,onColumnReorder:v,"data-testid":j}=e,[k,w]=(0,n.useState)(!1),[N,C]=(0,n.useState)(""),[D,I]=(0,n.useState)(!1),[E,L]=(0,n.useState)(t.title),S=(0,n.useCallback)(e=>{e.preventDefault(),e.currentTarget.classList.add("bg-blue-50","border-blue-300")},[]),M=(0,n.useCallback)(e=>{e.currentTarget.classList.remove("bg-blue-50","border-blue-300")},[]),T=(0,n.useCallback)(e=>{e.preventDefault(),e.currentTarget.classList.remove("bg-blue-50","border-blue-300");let t=e.currentTarget.getBoundingClientRect();y(Math.floor((e.clientY-t.top)/80))},[y]),A=(0,n.useCallback)(async()=>{if(N.trim()&&g)try{await g(t.id,{title:N.trim(),columnId:t.id,priority:"medium"}),C(""),w(!1)}catch(e){console.error("Failed to create card:",e)}},[N,t.id,g]),K=(0,n.useCallback)(async()=>{if(!E.trim()||E===t.title){I(!1),L(t.title);return}try{I(!1)}catch(e){console.error("Failed to update column title:",e),L(t.title)}},[E,t.title]),R=(0,n.useCallback)(e=>{"Enter"===e.key?k?A():D&&K():"Escape"===e.key&&(k?(w(!1),C("")):D&&(I(!1),L(t.title)))},[k,D,A,K,t.title]);return(0,r.jsxs)("div",{className:"w-80 flex-shrink-0 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200 transition-colors ".concat(c?"border-blue-300 bg-blue-50":""),onDragOver:S,onDragLeave:M,onDrop:T,role:"region","aria-label":"".concat(t.title," column"),"data-testid":j,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),D?(0,r.jsx)("input",{type:"text",value:E,onChange:e=>L(e.target.value),onKeyDown:R,onBlur:K,className:"text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded",onClick:()=>I(!0),children:t.title}),(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:a.length})]}),(0,r.jsx)("div",{className:"flex items-center space-x-1",children:(0,r.jsx)("button",{onClick:()=>w(!0),className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Add card",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})})]}),(0,r.jsxs)("div",{className:"p-2 space-y-2 max-h-[calc(100vh-200px)] overflow-y-auto",children:[(0,r.jsx)(s.M,{children:a.map((e,t)=>(0,r.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},layout:!0,children:(0,r.jsx)(i,{card:e,isSelected:u===e.id,isFocused:o===e.id,isDragging:d===e.id,onSelect:()=>m(e.id),onDragStart:()=>f(e.id),onDragEnd:b,onUpdate:h||(async()=>{}),onDelete:p||(async()=>{}),"data-testid":"kanban-card-".concat(e.id)})},e.id))}),(0,r.jsx)(s.M,{children:k&&(0,r.jsxs)(l.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"bg-white border border-gray-300 rounded-lg p-3",children:[(0,r.jsx)("textarea",{value:N,onChange:e=>C(e.target.value),onKeyDown:R,placeholder:"Enter card title...",className:"w-full text-sm border-none resize-none focus:outline-none focus:ring-0",rows:2,autoFocus:!0}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,r.jsx)("button",{onClick:A,className:"px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700",children:"Add Card"}),(0,r.jsx)("button",{onClick:()=>{w(!1),C("")},className:"px-3 py-1 text-sm font-medium text-gray-600 hover:text-gray-800",children:"Cancel"})]})]})}),0===a.length&&!k&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("svg",{className:"w-8 h-8 mx-auto mb-2 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,r.jsx)("p",{className:"text-sm",children:"No cards in this column"}),(0,r.jsx)("button",{onClick:()=>w(!0),className:"mt-2 text-xs text-blue-600 hover:text-blue-700",children:"Add card"})]})]})]})},d=e=>{let{isOpen:t,onClose:a,cards:i,onCardSelect:c,"data-testid":d}=e,[o,u]=(0,n.useState)(""),[m,x]=(0,n.useState)([]),[g,h]=(0,n.useState)(0),[p,f]=(0,n.useState)(!1),b=(0,n.useRef)(null),y=(0,n.useRef)(null);(0,n.useEffect)(()=>{t&&b.current&&(b.current.focus(),u(""),h(0))},[t]);let v=(0,n.useCallback)(e=>{if(!e.trim())return i.map(e=>({card:e,score:0,matches:[]}));let t=e.toLowerCase(),a=[];return i.forEach(e=>{var r,s,l;let n=0,i=[];e.title.toLowerCase().includes(t)&&(n+=100,i.push("title")),(null===(r=e.description)||void 0===r?void 0:r.toLowerCase().includes(t))&&(n+=50,i.push("description")),null===(s=e.tags)||void 0===s||s.forEach(e=>{e.toLowerCase().includes(t)&&(n+=30,i.push("tag"))}),(null===(l=e.assignee)||void 0===l?void 0:l.toLowerCase().includes(t))&&(n+=20,i.push("assignee")),e.status.toLowerCase().includes(t)&&(n+=10,i.push("status")),n>0&&a.push({card:e,score:n,matches:i})}),a.sort((e,t)=>t.score-e.score)},[i]);(0,n.useEffect)(()=>{if(!t)return;f(!0);let e=setTimeout(()=>{x(v(o)),h(0),f(!1)},150);return()=>clearTimeout(e)},[o,v,t]);let j=(0,n.useCallback)(e=>{switch(e.key){case"ArrowDown":e.preventDefault(),h(e=>Math.min(e+1,m.length-1));break;case"ArrowUp":e.preventDefault(),h(e=>Math.max(e-1,0));break;case"Enter":e.preventDefault(),m[g]&&(c(m[g].card.id),a());break;case"Escape":e.preventDefault(),a()}},[m,g,c,a]);(0,n.useEffect)(()=>{if(y.current&&g>=0){let e=y.current.children[g];e&&e.scrollIntoView({block:"nearest"})}},[g]);let k=(0,n.useCallback)(e=>{e.target===e.currentTarget&&a()},[a]),w=(e,t)=>{if(!t.trim())return e;let a=RegExp("(".concat(t,")"),"gi");return e.split(a).map((e,t)=>a.test(e)?(0,r.jsx)("span",{className:"bg-yellow-200 font-medium",children:e},t):e)},N=e=>{switch(e){case"urgent":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-300"}};return t?(0,r.jsx)(s.M,{children:(0,r.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-start justify-center pt-20",onClick:k,"data-testid":d,children:(0,r.jsxs)(l.E.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[70vh] flex flex-col",children:[(0,r.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,r.jsx)("input",{ref:b,type:"text",value:o,onChange:e=>u(e.target.value),onKeyDown:j,placeholder:"Search cards...",className:"flex-1 text-lg bg-transparent border-none outline-none placeholder-gray-400"}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:p?(0,r.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,r.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full mx-auto mb-2"}),"Searching..."]}):0===m.length?(0,r.jsx)("div",{className:"p-8 text-center text-gray-500",children:o?"No cards found":"Start typing to search cards"}):(0,r.jsx)("div",{ref:y,className:"divide-y divide-gray-100",children:m.map((e,t)=>(0,r.jsx)(l.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"p-4 cursor-pointer transition-colors ".concat(t===g?"bg-blue-50 border-l-4 border-blue-500":"hover:bg-gray-50"),onClick:()=>{c(e.card.id),a()},children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full mt-2 flex-shrink-0 ".concat(N(e.card.priority)),title:"Priority: ".concat(e.card.priority)}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:w(e.card.title,o)}),e.card.description&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:w(e.card.description,o)}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,r.jsx)("span",{className:"capitalize",children:e.card.status}),e.card.assignee&&(0,r.jsxs)("span",{children:["Assigned to ",e.card.assignee]}),e.card.dueDate&&(0,r.jsxs)("span",{children:["Due ",new Date(e.card.dueDate).toLocaleDateString()]})]}),e.matches.length>0&&(0,r.jsx)("div",{className:"flex items-center space-x-1 mt-2",children:e.matches.map((e,t)=>(0,r.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:e},t))})]}),t===g&&(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Press Enter"})]})},e.card.id))})}),(0,r.jsx)("div",{className:"p-3 border-t border-gray-200 bg-gray-50 rounded-b-lg",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("span",{children:"↑↓ Navigate"}),(0,r.jsx)("span",{children:"Enter Select"}),(0,r.jsx)("span",{children:"Esc Close"})]}),(0,r.jsxs)("span",{children:[m.length," result",1!==m.length?"s":""]})]})})]})})}):null},o=e=>{let{columns:t,cards:a,onCardMove:i,onColumnReorder:o,onCardSelect:u,onCardCreate:m,onCardUpdate:x,onCardDelete:g,selectedCardId:h,isLoading:p=!1,error:f=null}=e,[b,y]=(0,n.useState)(!1),[v,j]=(0,n.useState)(null),[k,w]=(0,n.useState)(null),[N,C]=(0,n.useState)(null),D=(0,n.useRef)(null),{optimisticData:I,applyOptimisticUpdate:E,revertOptimisticUpdate:L}=function(e){let[t,a]=(0,n.useState)(e),r=(0,n.useRef)(e),s=(0,n.useRef)(new Map);r.current!==e&&(r.current=e,a(e),s.current.clear());let l=(0,n.useCallback)((e,t)=>{a(a=>a.map(a=>a.id===e?{...a,...t}:a)),s.current.set(e,t)},[]);return{optimisticData:t,applyOptimisticUpdate:l,revertOptimisticUpdate:(0,n.useCallback)(e=>{a(t=>t.map(t=>t.id===e&&r.current.find(t=>t.id===e)||t)),s.current.delete(e)},[]),revertAllOptimisticUpdates:(0,n.useCallback)(()=>{a(r.current),s.current.clear()},[]),commitOptimisticUpdate:(0,n.useCallback)(e=>{s.current.delete(e)},[]),hasPendingUpdates:s.current.size>0}}(a),{isDragging:S,dragStart:M,dragEnd:T,drop:A}=function(){let[e,t]=(0,n.useState)({isDragging:!1,draggedItemId:null,draggedItemType:null}),a=(0,n.useRef)(0),r=(0,n.useRef)(100),s=(0,n.useCallback)(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"card",s=arguments.length>2?arguments[2]:void 0;a.current=Date.now(),t({isDragging:!0,draggedItemId:e||null,draggedItemType:r,...s&&{sourceColumnId:s}})},[]),l=(0,n.useCallback)(()=>{if(Date.now()-a.current<r.current){t({isDragging:!1,draggedItemId:null,draggedItemType:null});return}t({isDragging:!1,draggedItemId:null,draggedItemType:null})},[]),i=(0,n.useCallback)((e,a)=>{t({isDragging:!1,draggedItemId:null,draggedItemType:null})},[]),c=(0,n.useCallback)(t=>e.isDragging&&e.draggedItemId!==t,[e]),d=(0,n.useCallback)((t,a)=>!!e.isDragging&&e.draggedItemId!==a&&("card"===e.draggedItemType?"column"===t||"card"===t:"column"===e.draggedItemType&&"column"===t),[e]);return{isDragging:e.isDragging,draggedItemId:e.draggedItemId,draggedItemType:e.draggedItemType,sourceColumnId:e.sourceColumnId,dragStart:s,dragEnd:l,drop:i,isOverDropZone:c,canDrop:d}}(),{handleKeyDown:K,focusNextCard:R,focusPreviousCard:B}=function(e,t,a){let r=(0,n.useRef)(new Map),s=(0,n.useCallback)((e,t)=>{t?r.current.set(e,t):r.current.delete(e)},[]),l=(0,n.useCallback)(()=>{var s,l;if(!t){let t=e[0];t&&(a(t.id),null===(s=r.current.get(t.id))||void 0===s||s.focus());return}let n=e.findIndex(e=>e.id===t),i=e[n+1];i&&(a(i.id),null===(l=r.current.get(i.id))||void 0===l||l.focus())},[e,t,a]),i=(0,n.useCallback)(()=>{var s,l;if(!t){let t=e[e.length-1];t&&(a(t.id),null===(s=r.current.get(t.id))||void 0===s||s.focus());return}let n=e.findIndex(e=>e.id===t),i=e[n-1];i&&(a(i.id),null===(l=r.current.get(i.id))||void 0===l||l.focus())},[e,t,a]),c=(0,n.useCallback)(()=>{var s,l;if(!t)return;let n=e.find(e=>e.id===t);if(!n)return;let i=e.filter(e=>e.columnId===n.columnId),c=i.findIndex(e=>e.id===t),d=i[c+1];if(d){a(d.id),null===(s=r.current.get(d.id))||void 0===s||s.focus();return}let o=Array.from(new Set(e.map(e=>e.columnId))),u=o.indexOf(n.columnId),m=o[u+1];if(m){let t=e.find(e=>e.columnId===m);t&&(a(t.id),null===(l=r.current.get(t.id))||void 0===l||l.focus())}},[e,t,a]),d=(0,n.useCallback)(()=>{var s,l;if(!t)return;let n=e.find(e=>e.id===t);if(!n)return;let i=e.filter(e=>e.columnId===n.columnId),c=i.findIndex(e=>e.id===t),d=i[c-1];if(d){a(d.id),null===(s=r.current.get(d.id))||void 0===s||s.focus();return}let o=Array.from(new Set(e.map(e=>e.columnId))),u=o.indexOf(n.columnId),m=o[u-1];if(m){let t=e.filter(e=>e.columnId===m).pop();t&&(a(t.id),null===(l=r.current.get(t.id))||void 0===l||l.focus())}},[e,t,a]);return{handleKeyDown:(0,n.useCallback)(e=>{switch(e.key){case"ArrowRight":e.preventDefault(),c();break;case"ArrowLeft":e.preventDefault(),d();break;case"ArrowDown":e.preventDefault(),l();break;case"ArrowUp":e.preventDefault(),i();break;case"Enter":if(e.preventDefault(),t){let e=r.current.get(t);null==e||e.click()}break;case"Escape":e.preventDefault(),a(null)}},[t,l,i,c,d,a]),focusNextCard:l,focusPreviousCard:i,focusNextColumn:c,focusPreviousColumn:d,registerCardRef:s,focusedCardId:t}}(a,N,C);(0,n.useEffect)(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"k"===e.key&&(e.preventDefault(),y(!0))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);let F=(0,n.useCallback)(async(e,t,r)=>{if(!i)return;let s=a.find(t=>t.id===e);if(s&&(!s||s.columnId!==t)){E(e,{columnId:t});try{await i(e,t,r)}catch(t){L(e),console.error("Failed to move card:",t)}}},[a,i,E,L]),z=(0,n.useCallback)(async(e,t)=>{if(o)try{await o(e,t)}catch(e){console.error("Failed to reorder column:",e)}},[o]),U=(0,n.useCallback)(e=>{C(e),null==u||u(e)},[u]),O=(0,n.useCallback)((e,t)=>{j(e),w(t),M()},[M]),W=(0,n.useCallback)(()=>{j(null),w(null),T()},[T]),P=(0,n.useCallback)((e,t)=>{v&&F(v,e,t),W()},[v,F,W]),H=(I||[]).reduce((e,t)=>(e[t.columnId]||(e[t.columnId]=[]),e[t.columnId].push(t),e),{}),V=[...t].sort((e,t)=>e.order-t.order);return p?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):f?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Board"}),(0,r.jsx)("p",{className:"text-gray-600",children:f})]})}):(0,r.jsxs)("div",{ref:D,className:"flex flex-col h-full bg-gray-50",role:"region","aria-label":"Kanban board",onKeyDown:K,tabIndex:0,"data-testid":"kanban-board",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white border-b border-gray-200",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Kanban Board"}),(0,r.jsx)("div",{className:"flex items-center space-x-2",children:(0,r.jsxs)("button",{onClick:()=>y(!0),className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Search",(0,r.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"⌘K"})]})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-x-auto p-4",children:(0,r.jsx)("div",{className:"flex space-x-4 min-w-max",children:(0,r.jsx)(s.M,{children:V.map(e=>(0,r.jsx)(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},className:"flex-shrink-0",children:(0,r.jsx)(c,{column:e,cards:H[e.id]||[],isDragging:S,draggedCardId:v,focusedCardId:N,selectedCardId:h,onCardSelect:U,onCardMove:F,onCardCreate:m,onCardUpdate:x,onCardDelete:g,onDragStart:t=>O(t,e.id),onDragEnd:W,onDrop:t=>P(e.id,t),onColumnReorder:z,"data-testid":"kanban-column-".concat(e.id)})},e.id))})})}),(0,r.jsx)(s.M,{children:b&&(0,r.jsx)(d,{isOpen:b,cards:a,onCardSelect:U,onClose:()=>y(!1),"data-testid":"search-modal"})}),(0,r.jsx)("div",{className:"hidden md:block","data-testid":"desktop-layout"}),(0,r.jsx)("div",{className:"md:hidden","data-testid":"mobile-layout"})]})}}}]);