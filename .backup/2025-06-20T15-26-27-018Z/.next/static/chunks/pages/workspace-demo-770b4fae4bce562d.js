(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[349],{4133:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/workspace-demo",function(){return a(7949)}])},7949:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var r=a(5893),s=a(7294),n=a(3114),l=a(9092);let i=e=>{let{card:t,isSelected:a,isFocused:i,isDragging:d,onSelect:o,onDragStart:c,onDragEnd:u,onUpdate:m,onDelete:g,"data-testid":x}=e,[h,p]=(0,s.useState)(!1),[f,b]=(0,s.useState)(t.title),[y,v]=(0,s.useState)(!1),j=(0,s.useRef)(null),k=(0,s.useCallback)(()=>{o()},[o]),w=(0,s.useCallback)(e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id),c()},[t.id,c]),C=(0,s.useCallback)(()=>{u()},[u]),N=(0,s.useCallback)(()=>{p(!0),b(t.title)},[t.title]),D=(0,s.useCallback)(async()=>{if(!f.trim()||f===t.title){p(!1),b(t.title);return}if(m)try{await m(t.id,{title:f.trim()}),p(!1)}catch(e){console.error("Failed to update card title:",e),b(t.title)}},[f,t.title,t.id,m]),I=(0,s.useCallback)(()=>{p(!1),b(t.title)},[t.title]),E=(0,s.useCallback)(e=>{"Enter"===e.key?h?D():o():"Escape"===e.key?h&&I():"Delete"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),null==g||g(t.id))},[h,D,I,o,g,t.id]),S=(0,s.useCallback)(async()=>{if(g)try{await g(t.id)}catch(e){console.error("Failed to delete card:",e)}},[t.id,g]);return(0,r.jsxs)("div",{ref:j,className:"bg-white border rounded-lg shadow-sm p-4 cursor-pointer transition-all duration-200 ".concat(a?"ring-2 ring-blue-500 border-blue-300":"border-gray-200 hover:border-gray-300"," ").concat(d?"opacity-50 scale-105":""," ").concat(i?"ring-2 ring-blue-300":""),onClick:k,onDoubleClick:N,onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),draggable:!0,onDragStart:w,onDragEnd:C,onKeyDown:E,tabIndex:0,role:"button","aria-label":"".concat(t.title," card"),"data-testid":x,children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsx)("div",{className:"flex-1 min-w-0",children:h?(0,r.jsx)("textarea",{value:f,onChange:e=>b(e.target.value),onKeyDown:E,onBlur:D,className:"w-full text-sm font-medium text-gray-900 bg-transparent border-none resize-none focus:outline-none focus:ring-0",rows:2,autoFocus:!0}):(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:t.title})}),(0,r.jsx)("div",{className:"w-2 h-2 rounded-full ml-2 flex-shrink-0 ".concat((e=>{switch(e){case"urgent":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-300"}})(t.priority)),title:"Priority: ".concat(t.priority)})]}),t.description&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:t.description}),t.tags&&t.tags.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mb-3",children:[t.tags.slice(0,3).map((e,t)=>(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e},t)),t.tags.length>3&&(0,r.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:["+",t.tags.length-3]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[t.assignee&&(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("div",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-xs font-medium text-gray-700",children:t.assignee.charAt(0).toUpperCase()})})}),t.dueDate&&(0,r.jsx)("span",{className:"text-xs text-gray-500",children:new Date(t.dueDate).toLocaleDateString()})]}),(0,r.jsx)(n.M,{children:y&&(0,r.jsxs)(l.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center space-x-1",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),p(!0)},className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Edit",children:(0,r.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),g&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),S()},className:"p-1 text-gray-400 hover:text-red-600 rounded",title:"Delete",children:(0,r.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]}),i&&(0,r.jsx)("div",{className:"absolute inset-0 ring-2 ring-blue-500 ring-inset rounded-lg pointer-events-none"})]})},d=e=>{let{column:t,cards:a,isDragging:d,draggedCardId:o,focusedCardId:c,selectedCardId:u,onCardSelect:m,onCardMove:g,onCardCreate:x,onCardUpdate:h,onCardDelete:p,onDragStart:f,onDragEnd:b,onDrop:y,onColumnReorder:v,"data-testid":j}=e,[k,w]=(0,s.useState)(!1),[C,N]=(0,s.useState)(""),[D,I]=(0,s.useState)(!1),[E,S]=(0,s.useState)(t.title),L=(0,s.useCallback)(e=>{e.preventDefault(),e.currentTarget.classList.add("bg-blue-50","border-blue-300")},[]),T=(0,s.useCallback)(e=>{e.currentTarget.classList.remove("bg-blue-50","border-blue-300")},[]),M=(0,s.useCallback)(e=>{e.preventDefault(),e.currentTarget.classList.remove("bg-blue-50","border-blue-300");let t=e.currentTarget.getBoundingClientRect();y(Math.floor((e.clientY-t.top)/80))},[y]),A=(0,s.useCallback)(async()=>{if(C.trim()&&x)try{await x(t.id,{title:C.trim(),status:"todo",columnId:t.id,priority:"medium"}),N(""),w(!1)}catch(e){console.error("Failed to create card:",e)}},[C,t.id,x]),B=(0,s.useCallback)(async()=>{if(!E.trim()||E===t.title){I(!1),S(t.title);return}try{I(!1)}catch(e){console.error("Failed to update column title:",e),S(t.title)}},[E,t.title]),K=(0,s.useCallback)(e=>{"Enter"===e.key?k?A():D&&B():"Escape"===e.key&&(k?(w(!1),N("")):D&&(I(!1),S(t.title)))},[k,D,A,B,t.title]);return(0,r.jsxs)("div",{className:"w-80 flex-shrink-0 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200 transition-colors ".concat(d?"border-blue-300 bg-blue-50":""),onDragOver:L,onDragLeave:T,onDrop:M,role:"region","aria-label":"".concat(t.title," column"),"data-testid":j,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),D?(0,r.jsx)("input",{type:"text",value:E,onChange:e=>S(e.target.value),onKeyDown:K,onBlur:B,className:"text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded",onClick:()=>I(!0),children:t.title}),(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:a.length})]}),(0,r.jsx)("div",{className:"flex items-center space-x-1",children:(0,r.jsx)("button",{onClick:()=>w(!0),className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Add card",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})})]}),(0,r.jsxs)("div",{className:"p-2 space-y-2 max-h-[calc(100vh-200px)] overflow-y-auto",children:[(0,r.jsx)(n.M,{children:a.map((e,t)=>(0,r.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},layout:!0,children:(0,r.jsx)(i,{card:e,isSelected:u===e.id,isFocused:c===e.id,isDragging:o===e.id,onSelect:()=>m(e.id),onDragStart:()=>f(e.id),onDragEnd:b,onUpdate:h,onDelete:p,"data-testid":"kanban-card-".concat(e.id)})},e.id))}),(0,r.jsx)(n.M,{children:k&&(0,r.jsxs)(l.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"bg-white border border-gray-300 rounded-lg p-3",children:[(0,r.jsx)("textarea",{value:C,onChange:e=>N(e.target.value),onKeyDown:K,placeholder:"Enter card title...",className:"w-full text-sm border-none resize-none focus:outline-none focus:ring-0",rows:2,autoFocus:!0}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,r.jsx)("button",{onClick:A,className:"px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700",children:"Add Card"}),(0,r.jsx)("button",{onClick:()=>{w(!1),N("")},className:"px-3 py-1 text-sm font-medium text-gray-600 hover:text-gray-800",children:"Cancel"})]})]})}),0===a.length&&!k&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("svg",{className:"w-8 h-8 mx-auto mb-2 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,r.jsx)("p",{className:"text-sm",children:"No cards in this column"}),(0,r.jsx)("button",{onClick:()=>w(!0),className:"mt-2 text-xs text-blue-600 hover:text-blue-700",children:"Add card"})]})]})]})},o=e=>{let{isOpen:t,onClose:a,cards:i,onCardSelect:d,"data-testid":o}=e,[c,u]=(0,s.useState)(""),[m,g]=(0,s.useState)([]),[x,h]=(0,s.useState)(0),[p,f]=(0,s.useState)(!1),b=(0,s.useRef)(null),y=(0,s.useRef)(null);(0,s.useEffect)(()=>{t&&b.current&&(b.current.focus(),u(""),h(0))},[t]);let v=(0,s.useCallback)(e=>{if(!e.trim())return i.map(e=>({card:e,score:0,matches:[]}));let t=e.toLowerCase(),a=[];return i.forEach(e=>{var r,s,n;let l=0,i=[];e.title.toLowerCase().includes(t)&&(l+=100,i.push("title")),(null===(r=e.description)||void 0===r?void 0:r.toLowerCase().includes(t))&&(l+=50,i.push("description")),null===(s=e.tags)||void 0===s||s.forEach(e=>{e.toLowerCase().includes(t)&&(l+=30,i.push("tag"))}),(null===(n=e.assignee)||void 0===n?void 0:n.toLowerCase().includes(t))&&(l+=20,i.push("assignee")),e.status.toLowerCase().includes(t)&&(l+=10,i.push("status")),l>0&&a.push({card:e,score:l,matches:i})}),a.sort((e,t)=>t.score-e.score)},[i]);(0,s.useEffect)(()=>{if(!t)return;f(!0);let e=setTimeout(()=>{g(v(c)),h(0),f(!1)},150);return()=>clearTimeout(e)},[c,v,t]);let j=(0,s.useCallback)(e=>{switch(e.key){case"ArrowDown":e.preventDefault(),h(e=>Math.min(e+1,m.length-1));break;case"ArrowUp":e.preventDefault(),h(e=>Math.max(e-1,0));break;case"Enter":e.preventDefault(),m[x]&&(d(m[x].card.id),a());break;case"Escape":e.preventDefault(),a()}},[m,x,d,a]);(0,s.useEffect)(()=>{if(y.current&&x>=0){let e=y.current.children[x];e&&e.scrollIntoView({block:"nearest"})}},[x]);let k=(0,s.useCallback)(e=>{e.target===e.currentTarget&&a()},[a]),w=(e,t)=>{if(!t.trim())return e;let a=RegExp("(".concat(t,")"),"gi");return e.split(a).map((e,t)=>a.test(e)?(0,r.jsx)("span",{className:"bg-yellow-200 font-medium",children:e},t):e)},C=e=>{switch(e){case"urgent":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-300"}};return t?(0,r.jsx)(n.M,{children:(0,r.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-start justify-center pt-20",onClick:k,"data-testid":o,children:(0,r.jsxs)(l.E.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[70vh] flex flex-col",children:[(0,r.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,r.jsx)("input",{ref:b,type:"text",value:c,onChange:e=>u(e.target.value),onKeyDown:j,placeholder:"Search cards...",className:"flex-1 text-lg bg-transparent border-none outline-none placeholder-gray-400"}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:p?(0,r.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,r.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full mx-auto mb-2"}),"Searching..."]}):0===m.length?(0,r.jsx)("div",{className:"p-8 text-center text-gray-500",children:c?"No cards found":"Start typing to search cards"}):(0,r.jsx)("div",{ref:y,className:"divide-y divide-gray-100",children:m.map((e,t)=>(0,r.jsx)(l.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"p-4 cursor-pointer transition-colors ".concat(t===x?"bg-blue-50 border-l-4 border-blue-500":"hover:bg-gray-50"),onClick:()=>{d(e.card.id),a()},children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full mt-2 flex-shrink-0 ".concat(C(e.card.priority)),title:"Priority: ".concat(e.card.priority)}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:w(e.card.title,c)}),e.card.description&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:w(e.card.description,c)}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,r.jsx)("span",{className:"capitalize",children:e.card.status}),e.card.assignee&&(0,r.jsxs)("span",{children:["Assigned to ",e.card.assignee]}),e.card.dueDate&&(0,r.jsxs)("span",{children:["Due ",new Date(e.card.dueDate).toLocaleDateString()]})]}),e.matches.length>0&&(0,r.jsx)("div",{className:"flex items-center space-x-1 mt-2",children:e.matches.map((e,t)=>(0,r.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:e},t))})]}),t===x&&(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Press Enter"})]})},e.card.id))})}),(0,r.jsx)("div",{className:"p-3 border-t border-gray-200 bg-gray-50 rounded-b-lg",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("span",{children:"↑↓ Navigate"}),(0,r.jsx)("span",{children:"Enter Select"}),(0,r.jsx)("span",{children:"Esc Close"})]}),(0,r.jsxs)("span",{children:[m.length," result",1!==m.length?"s":""]})]})})]})})}):null},c=e=>{let{columns:t,cards:a,onCardMove:i,onColumnReorder:c,onCardSelect:u,onCardCreate:m,onCardUpdate:g,onCardDelete:x,selectedCardId:h,isLoading:p=!1,error:f=null}=e,[b,y]=(0,s.useState)(!1),[v,j]=(0,s.useState)(null),[k,w]=(0,s.useState)(null),[C,N]=(0,s.useState)(null),D=(0,s.useRef)(null),{optimisticData:I,applyOptimisticUpdate:E,revertOptimisticUpdate:S}=function(e){let[t,a]=(0,s.useState)(e),r=(0,s.useRef)(e),n=(0,s.useRef)(new Map);r.current!==e&&(r.current=e,a(e),n.current.clear());let l=(0,s.useCallback)((e,t)=>{a(a=>a.map(a=>a.id===e?{...a,...t}:a)),n.current.set(e,t)},[]);return{optimisticData:t,applyOptimisticUpdate:l,revertOptimisticUpdate:(0,s.useCallback)(e=>{a(t=>t.map(t=>t.id===e&&r.current.find(t=>t.id===e)||t)),n.current.delete(e)},[]),revertAllOptimisticUpdates:(0,s.useCallback)(()=>{a(r.current),n.current.clear()},[]),commitOptimisticUpdate:(0,s.useCallback)(e=>{n.current.delete(e)},[]),hasPendingUpdates:n.current.size>0}}(a),{isDragging:L,dragStart:T,dragEnd:M,drop:A}=function(){let[e,t]=(0,s.useState)({isDragging:!1,draggedItemId:null,draggedItemType:null}),a=(0,s.useRef)(0),r=(0,s.useRef)(100),n=(0,s.useCallback)(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"card",s=arguments.length>2?arguments[2]:void 0;a.current=Date.now(),t({isDragging:!0,draggedItemId:e||null,draggedItemType:r,...s&&{sourceColumnId:s}})},[]),l=(0,s.useCallback)(()=>{if(Date.now()-a.current<r.current){t({isDragging:!1,draggedItemId:null,draggedItemType:null});return}t({isDragging:!1,draggedItemId:null,draggedItemType:null})},[]),i=(0,s.useCallback)((e,a)=>{t({isDragging:!1,draggedItemId:null,draggedItemType:null})},[]),d=(0,s.useCallback)(t=>e.isDragging&&e.draggedItemId!==t,[e]),o=(0,s.useCallback)((t,a)=>!!e.isDragging&&e.draggedItemId!==a&&("card"===e.draggedItemType?"column"===t||"card"===t:"column"===e.draggedItemType&&"column"===t),[e]);return{isDragging:e.isDragging,draggedItemId:e.draggedItemId,draggedItemType:e.draggedItemType,sourceColumnId:e.sourceColumnId,dragStart:n,dragEnd:l,drop:i,isOverDropZone:d,canDrop:o}}(),{handleKeyDown:B,focusNextCard:K,focusPreviousCard:R}=function(e,t,a){let r=(0,s.useRef)(new Map),n=(0,s.useCallback)((e,t)=>{t?r.current.set(e,t):r.current.delete(e)},[]),l=(0,s.useCallback)(()=>{var s,n;if(!t){let t=e[0];t&&(a(t.id),null===(s=r.current.get(t.id))||void 0===s||s.focus());return}let l=e.findIndex(e=>e.id===t),i=e[l+1];i&&(a(i.id),null===(n=r.current.get(i.id))||void 0===n||n.focus())},[e,t,a]),i=(0,s.useCallback)(()=>{var s,n;if(!t){let t=e[e.length-1];t&&(a(t.id),null===(s=r.current.get(t.id))||void 0===s||s.focus());return}let l=e.findIndex(e=>e.id===t),i=e[l-1];i&&(a(i.id),null===(n=r.current.get(i.id))||void 0===n||n.focus())},[e,t,a]),d=(0,s.useCallback)(()=>{var s,n;if(!t)return;let l=e.find(e=>e.id===t);if(!l)return;let i=e.filter(e=>e.columnId===l.columnId),d=i.findIndex(e=>e.id===t),o=i[d+1];if(o){a(o.id),null===(s=r.current.get(o.id))||void 0===s||s.focus();return}let c=Array.from(new Set(e.map(e=>e.columnId))),u=c.indexOf(l.columnId),m=c[u+1];if(m){let t=e.find(e=>e.columnId===m);t&&(a(t.id),null===(n=r.current.get(t.id))||void 0===n||n.focus())}},[e,t,a]),o=(0,s.useCallback)(()=>{var s,n;if(!t)return;let l=e.find(e=>e.id===t);if(!l)return;let i=e.filter(e=>e.columnId===l.columnId),d=i.findIndex(e=>e.id===t),o=i[d-1];if(o){a(o.id),null===(s=r.current.get(o.id))||void 0===s||s.focus();return}let c=Array.from(new Set(e.map(e=>e.columnId))),u=c.indexOf(l.columnId),m=c[u-1];if(m){let t=e.filter(e=>e.columnId===m).pop();t&&(a(t.id),null===(n=r.current.get(t.id))||void 0===n||n.focus())}},[e,t,a]);return{handleKeyDown:(0,s.useCallback)(e=>{switch(e.key){case"ArrowRight":e.preventDefault(),d();break;case"ArrowLeft":e.preventDefault(),o();break;case"ArrowDown":e.preventDefault(),l();break;case"ArrowUp":e.preventDefault(),i();break;case"Enter":if(e.preventDefault(),t){let e=r.current.get(t);null==e||e.click()}break;case"Escape":e.preventDefault(),a(null)}},[t,l,i,d,o,a]),focusNextCard:l,focusPreviousCard:i,focusNextColumn:d,focusPreviousColumn:o,registerCardRef:n,focusedCardId:t}}(a,C,N);(0,s.useEffect)(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"k"===e.key&&(e.preventDefault(),y(!0))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);let P=(0,s.useCallback)(async(e,t,r)=>{if(!i)return;let s=a.find(t=>t.id===e);if(s&&s.columnId!==t){E(e,{columnId:t});try{await i(e,t,r)}catch(t){S(e),console.error("Failed to move card:",t)}}},[a,i,E,S]),F=(0,s.useCallback)(async(e,t)=>{if(c)try{await c(e,t)}catch(e){console.error("Failed to reorder column:",e)}},[c]),_=(0,s.useCallback)(e=>{N(e),null==u||u(e)},[u]),U=(0,s.useCallback)((e,t)=>{j(e),w(t),T()},[T]),z=(0,s.useCallback)(()=>{j(null),w(null),M()},[M]),O=(0,s.useCallback)((e,t)=>{v&&P(v,e,t),z()},[v,P,z]),W=(I||[]).reduce((e,t)=>(e[t.columnId]||(e[t.columnId]=[]),e[t.columnId].push(t),e),{}),H=[...t].sort((e,t)=>e.order-t.order);return p?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):f?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Board"}),(0,r.jsx)("p",{className:"text-gray-600",children:f})]})}):(0,r.jsxs)("div",{ref:D,className:"flex flex-col h-full bg-gray-50",role:"region","aria-label":"Kanban board",onKeyDown:B,tabIndex:0,"data-testid":"kanban-board",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white border-b border-gray-200",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Kanban Board"}),(0,r.jsx)("div",{className:"flex items-center space-x-2",children:(0,r.jsxs)("button",{onClick:()=>y(!0),className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Search",(0,r.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"⌘K"})]})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-x-auto p-4",children:(0,r.jsx)("div",{className:"flex space-x-4 min-w-max",children:(0,r.jsx)(n.M,{children:H.map(e=>(0,r.jsx)(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},className:"flex-shrink-0",children:(0,r.jsx)(d,{column:e,cards:W[e.id]||[],isDragging:L,draggedCardId:v,focusedCardId:C,selectedCardId:h,onCardSelect:_,onCardMove:P,onCardCreate:m,onCardUpdate:g,onCardDelete:x,onDragStart:t=>U(t,e.id),onDragEnd:z,onDrop:t=>O(e.id,t),onColumnReorder:F,"data-testid":"kanban-column-".concat(e.id)})},e.id))})})}),(0,r.jsx)(n.M,{children:b&&(0,r.jsx)(o,{isOpen:b,cards:a,onCardSelect:_,onClose:()=>y(!1),"data-testid":"search-modal"})}),(0,r.jsx)("div",{className:"hidden md:block","data-testid":"desktop-layout"}),(0,r.jsx)("div",{className:"md:hidden","data-testid":"mobile-layout"})]})},u=[{id:"col-1",title:"To Do",order:1,color:"#3B82F6"},{id:"col-2",title:"In Progress",order:2,color:"#F59E0B"},{id:"col-3",title:"Done",order:3,color:"#10B981"}],m=[{id:"card-1",title:"Implement drag and drop",description:"Add drag and drop functionality to the Kanban board",status:"todo",priority:"high",columnId:"col-1",tags:["feature","ui"],assignee:"John Doe",dueDate:"2024-01-15"},{id:"card-2",title:"Add keyboard navigation",description:"Implement keyboard shortcuts for navigation",status:"in-progress",priority:"medium",columnId:"col-2",tags:["accessibility"],assignee:"Jane Smith",dueDate:"2024-01-20"},{id:"card-3",title:"Write tests",description:"Add comprehensive test coverage",status:"done",priority:"low",columnId:"col-3",tags:["testing"],assignee:"Bob Johnson",dueDate:"2024-01-10"}];function g(){let e=async(e,t,a)=>{console.log("Moving card:",e,"to column:",t,"at position:",a),await new Promise(e=>setTimeout(e,100))},t=async(e,t)=>{console.log("Creating card in column:",e,t),await new Promise(e=>setTimeout(e,100))},a=async(e,t)=>{console.log("Updating card:",e,t),await new Promise(e=>setTimeout(e,100))},s=async e=>{console.log("Deleting card:",e),await new Promise(e=>setTimeout(e,100))},n=async(e,t)=>{console.log("Reordering column:",e,"to order:",t),await new Promise(e=>setTimeout(e,100))};return(0,r.jsx)("div",{className:"h-screen bg-gray-50",children:(0,r.jsx)(c,{columns:u,cards:m,onCardMove:e,onCardCreate:t,onCardUpdate:a,onCardDelete:s,onColumnReorder:n,onCardSelect:e=>{console.log("Selected card:",e)}})})}}},function(e){e.O(0,[274,888,774,179],function(){return e(e.s=4133)}),_N_E=e.O()}]);